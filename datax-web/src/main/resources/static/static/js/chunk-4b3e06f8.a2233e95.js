(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4b3e06f8"],{"34e3":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"build-container"},[r("el-steps",{attrs:{active:e.active,"finish-status":"success"}},[r("el-step",{attrs:{title:"步骤 1",description:"构建reader"}},[e._v("1")]),e._v(" "),r("el-step",{attrs:{title:"步骤 2",description:"构建writer"}},[e._v("2")])],1),e._v(" "),r("el-button",{staticStyle:{"margin-top":"12px","margin-bottom":"12px"},on:{click:e.next}},[e._v("下一步")]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active===1"}],staticClass:"step1"},[r("el-form",{attrs:{"label-position":"left","label-width":"80px",model:e.readerForm}},[r("el-form-item",{attrs:{label:"数据源"}},[r("el-select",{attrs:{filterable:""},on:{change:e.rDsChange},model:{value:e.readerForm.id,callback:function(t){e.$set(e.readerForm,"id",t)},expression:"readerForm.id"}},e._l(e.rDsList,function(e){return r("el-option",{key:e.id,attrs:{label:e.datasourceName,value:e.id}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"表"}},[r("el-select",{attrs:{filterable:""},on:{change:e.rTbChange},model:{value:e.readerForm.tableName,callback:function(t){e.$set(e.readerForm,"tableName",t)},expression:"readerForm.tableName"}},e._l(e.rTbList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"字段"}},[r("el-transfer",{attrs:{filterable:"",data:e.rColumnList,titles:["可选字段","抽取的字段"]},model:{value:e.readerForm.columns,callback:function(t){e.$set(e.readerForm,"columns",t)},expression:"readerForm.columns"}})],1)],1)],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:2===e.active,expression:"active===2"}],staticClass:"step2"},[r("el-form",{attrs:{"label-position":"left","label-width":"80px",model:e.readerForm}},[r("el-form-item",[r("el-switch",{attrs:{"active-text":"streamwriter","inactive-text":"other"},model:{value:e.ifStreamWriter,callback:function(t){e.ifStreamWriter=t},expression:"ifStreamWriter"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"数据源"}},[r("el-select",{attrs:{disabled:e.ifStreamWriter,filterable:""},on:{change:e.wDsChange},model:{value:e.writerForm.id,callback:function(t){e.$set(e.writerForm,"id",t)},expression:"writerForm.id"}},e._l(e.rDsList,function(e){return r("el-option",{key:e.id,attrs:{label:e.datasourceName,value:e.id}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"表"}},[r("el-select",{attrs:{disabled:e.ifStreamWriter,filterable:""},on:{change:e.wTbChange},model:{value:e.writerForm.tableName,callback:function(t){e.$set(e.writerForm,"tableName",t)},expression:"writerForm.tableName"}},e._l(e.wTbList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"字段"}},[r("el-transfer",{attrs:{disabled:e.ifStreamWriter,filterable:"",data:e.wColumnList,titles:["可选字段","抽取的字段"]},model:{value:e.writerForm.columns,callback:function(t){e.$set(e.writerForm,"columns",t)},expression:"writerForm.columns"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.beforeBuildJson}},[e._v("构建")])],1)],1)],1)],1),e._v(" "),r("json-editor",{directives:[{name:"show",rawName:"v-show",value:2===e.active,expression:"active===2"}],ref:"jsonEditor",model:{value:e.configJson,callback:function(t){e.configJson=t},expression:"configJson"}})],1)},i=[],o=(r("ac6a"),r("b775"));function s(e){return Object(o["a"])({url:"/api/jdbcDatasourceQuery/getTables",method:"get",params:e})}function n(e){return Object(o["a"])({url:"/api/jdbcDatasourceQuery/getColumns",method:"get",params:e})}function l(e){return Object(o["a"])({url:"/api/dataxJson/buildJson",method:"post",data:e})}var c=r("7e39"),u=r("fa7e"),d={components:{JsonEditor:u["a"]},data:function(){return{configJson:"",jdbcDsQuery:{current:1,size:50},rDsList:[],rTbList:[],rColumnList:[],loading:!1,active:1,readerForm:{datasourceId:void 0,tableName:"",columns:[]},ifStreamWriter:!0,wDsList:[],wTbList:[],wColumnList:[],writerForm:{datasourceId:void 0,tableName:"",columns:[]}}},created:function(){this.getJdbcDs()},methods:{getJdbcDs:function(){var e=this;this.loading=!0,Object(c["d"])(this.jdbcDsQuery).then(function(t){var r=t.records;e.rDsList=r,e.loading=!1})},getTables:function(e){var t=this;if("reader"===e){var r={datasourceId:this.readerForm.datasourceId};s(r).then(function(e){t.rTbList=e})}else if("writer"===e){var a={datasourceId:this.writerForm.datasourceId};s(a).then(function(e){t.wTbList=e})}},last:function(){this.active--<1&&(this.active=1)},next:function(){1===this.active?this.readerForm.columns.length>0?this.active++:this.$message({message:"无法进行下一步",type:"warning"}):this.active=1},rDsChange:function(e){this.readerForm.tableName="",this.readerForm.datasourceId=e,this.getTables("reader")},wDsChange:function(e){this.writerForm.tableName="",this.writerForm.datasourceId=e,this.getTables("writer")},getColumns:function(e){var t=this;if("reader"===e){var r={datasourceId:this.readerForm.datasourceId,tableName:this.readerForm.tableName};n(r).then(function(e){var r=[];console.log(e),e.forEach(function(e){r.push({key:e,label:e,disabled:!1})}),t.rColumnList=r})}else if("writer"===e){var a={datasourceId:this.writerForm.datasourceId,tableName:this.writerForm.tableName};n(a).then(function(e){var r=[];console.log(e),e.forEach(function(e){r.push({key:e,label:e,disabled:!1})}),console.log(r),t.wColumnList=r})}},rTbChange:function(e){this.readerForm.tableName=e,this.rColumnList=[],this.readerForm.columns=[],this.getColumns("reader")},wTbChange:function(e){this.writerForm.tableName=e,this.wColumnList=[],this.writerForm.columns=[],this.getColumns("writer")},beforeBuildJson:function(){(this.writerForm.columns.length>0||!0===this.ifStreamWriter)&&this.buildJson()},buildJson:function(){var e=this;console.info(this.readerForm);var t={readerDatasourceId:this.readerForm.datasourceId,readerTables:[this.readerForm.tableName],readerColumns:this.readerForm.columns,ifStreamWriter:this.ifStreamWriter,writerDatasourceId:this.writerForm.datasourceId,writerTables:[this.writerForm.tableName],writerColumns:this.writerForm.columns};console.info(t),l(t).then(function(t){console.log(t),e.configJson=JSON.parse(t)})}}},m=d,f=r("2877"),b=Object(f["a"])(m,a,i,!1,null,"d14f8694",null);t["default"]=b.exports},"7e39":function(e,t,r){"use strict";r.d(t,"d",function(){return i}),r.d(t,"c",function(){return o}),r.d(t,"e",function(){return s}),r.d(t,"a",function(){return n}),r.d(t,"b",function(){return l});var a=r("b775");function i(e){return Object(a["a"])({url:"/api/jobJdbcDatasource",method:"get",params:e})}function o(e){return Object(a["a"])({url:"/api/jobJdbcDatasource/"+e,method:"get"})}function s(e){return Object(a["a"])({url:"/api/jobJdbcDatasource/",method:"put",data:e})}function n(e){return Object(a["a"])({url:"/api/jobJdbcDatasource/",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/api/jobJdbcDatasource/",method:"delete",params:e})}},b8b0:function(e,t,r){"use strict";var a=r("f84c"),i=r.n(a);i.a},f84c:function(e,t,r){},fa7e:function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"json-editor"},[r("textarea",{ref:"textarea"})])},i=[],o=r("56b3"),s=r.n(o);r("0dd0"),r("a7be"),r("acdf"),r("f9d4"),r("8822"),r("d2de");r("ae67");var n={name:"JsonEditor",props:["value"],data:function(){return{jsonEditor:!1}},watch:{value:function(e){var t=this.jsonEditor.getValue();e!==t&&this.jsonEditor.setValue(JSON.stringify(this.value,null,2))}},mounted:function(){var e=this;this.jsonEditor=s.a.fromTextArea(this.$refs.textarea,{lineNumbers:!0,mode:"application/json",gutters:["CodeMirror-lint-markers"],theme:"rubyblue",lint:!0}),this.jsonEditor.setValue(JSON.stringify(this.value,null,2)),this.jsonEditor.on("change",function(t){e.$emit("changed",t.getValue()),e.$emit("input",t.getValue())})},methods:{getValue:function(){return this.jsonEditor.getValue()}}},l=n,c=(r("b8b0"),r("2877")),u=Object(c["a"])(l,a,i,!1,null,"fad11014",null);t["a"]=u.exports}}]);