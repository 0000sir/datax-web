(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a33505b"],{"05a0":function(t,o,e){"use strict";e.r(o);var n=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"filter-container"},[e("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:t.handleRunJob}},[t._v("\n      启动任务\n    ")]),t._v(" "),e("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"Type",clearable:""},on:{change:t.handleJobChange,clear:t.handleJobClear},model:{value:t.jobId,callback:function(o){t.jobId=o},expression:"jobId"}},t._l(t.pluginList,function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),e("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:t.getJobList}},[t._v("\n      刷新任务\n    ")]),t._v(" "),e("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-trash"},on:{click:function(o){t.templateJson={}}}},[t._v("\n      清空json\n    ")]),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.jobId,expression:"jobId"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-document"},on:{click:t.handleViewJobLog}},[t._v("\n      查看日志\n    ")])],1),t._v(" "),e("div",{staticClass:"editor-container"},[e("json-editor",{ref:"jsonEditor",model:{value:t.templateJson,callback:function(o){t.templateJson=o},expression:"templateJson"}})],1),t._v(" "),e("el-dialog",{attrs:{title:"日志查看",visible:t.logShow},on:{"update:visible":function(o){t.logShow=o}}},[e("div",{staticClass:"log-container"},[e("pre",{attrs:{loading:t.logLoading},domProps:{textContent:t._s(t.logContent)}})]),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(o){return t.loadLog()}}},[t._v("\n        刷新日志\n      ")])],1)])],1)},i=[],a=(e("ac4d"),e("8a81"),e("ac6a"),e("b775"));function r(t){return Object(a["a"])({url:"/api/runJob",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/api/runJobLog",method:"post",data:t})}var l=e("d4a6"),u=e("fa7e"),c={components:{JsonEditor:u["a"]},data:function(){return{templateJson:{},listQuery:{current:1,size:200},pluginList:[1,2],jobId:void 0,jobLogQuery:{id:void 0,fromLineNum:0},logContent:void 0,logShow:!1,logLoading:!1}},created:function(){this.getJobList()},methods:{getJobList:function(){var t=this;Object(l["d"])(this.listQuery).then(function(o){console.log(o),t.jobId=void 0,t.jobLogQuery.fromLineNum=0,t.logContent=void 0;var e=o.records;t.pluginList=e})},handleRunJob:function(){var t=this,o={jobConfigId:this.jobId,jobJson:this.templateJson};void 0===this.jobId?r(this.templateJson).then(function(o){t.$notify({title:"Success",message:"启动成功",type:"success",duration:2e3}),t.handleViewJobLog()}):s(o).then(function(o){t.$notify({title:"Success",message:"启动成功",type:"success",duration:2e3})})},handleViewJobLog:function(){void 0!==this.jobId&&(this.jobLogQuery.id=this.jobId,!1===this.logShow&&(this.logShow=!0),this.loadLog())},loadLog:function(){var t=this;this.logLoading=!0,Object(l["f"])(this.jobLogQuery).then(function(o){"\n"===o.logContent||(t.logContent=o.logContent),t.logLoading=!1})},handleJobChange:function(t){this.jobId=t,this.jobLogQuery.fromLineNum=0;var o=!0,e=!1,n=void 0;try{for(var i,a=this.pluginList[Symbol.iterator]();!(o=(i=a.next()).done);o=!0){var r=i.value;if(r.id===this.jobId){this.templateJson=JSON.parse(r.configJson);break}}}catch(s){e=!0,n=s}finally{try{o||null==a.return||a.return()}finally{if(e)throw n}}},handleJobClear:function(){this.jobId=void 0,this.logShow=!1,this.logContent=void 0}}},d=c,f=(e("a82b"),e("2877")),b=Object(f["a"])(d,n,i,!1,null,"abbdf2ce",null);o["default"]=b.exports},a82b:function(t,o,e){"use strict";var n=e("af9c"),i=e.n(n);i.a},af9c:function(t,o,e){},b8b0:function(t,o,e){"use strict";var n=e("f84c"),i=e.n(n);i.a},d4a6:function(t,o,e){"use strict";e.d(o,"d",function(){return i}),e.d(o,"c",function(){return a}),e.d(o,"e",function(){return r}),e.d(o,"a",function(){return s}),e.d(o,"b",function(){return l}),e.d(o,"f",function(){return u});var n=e("b775");function i(t){return Object(n["a"])({url:"/api/jobConfig",method:"get",params:t})}function a(t){return Object(n["a"])({url:"/api/jobConfig/"+t,method:"get"})}function r(t){return Object(n["a"])({url:"/api/jobConfig/",method:"put",data:t})}function s(t){return Object(n["a"])({url:"/api/jobConfig/",method:"post",data:t})}function l(t){return Object(n["a"])({url:"/api/jobConfig/",method:"delete",params:t})}function u(t){return Object(n["a"])({url:"/api/viewJobLog",method:"get",params:t})}},f84c:function(t,o,e){},fa7e:function(t,o,e){"use strict";var n=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"json-editor"},[e("textarea",{ref:"textarea"})])},i=[],a=e("56b3"),r=e.n(a);e("0dd0"),e("a7be"),e("acdf"),e("f9d4"),e("8822"),e("d2de");e("ae67");var s={name:"JsonEditor",props:["value"],data:function(){return{jsonEditor:!1}},watch:{value:function(t){var o=this.jsonEditor.getValue();t!==o&&this.jsonEditor.setValue(JSON.stringify(this.value,null,2))}},mounted:function(){var t=this;this.jsonEditor=r.a.fromTextArea(this.$refs.textarea,{lineNumbers:!0,mode:"application/json",gutters:["CodeMirror-lint-markers"],theme:"rubyblue",lint:!0}),this.jsonEditor.setValue(JSON.stringify(this.value,null,2)),this.jsonEditor.on("change",function(o){t.$emit("changed",o.getValue()),t.$emit("input",o.getValue())})},methods:{getValue:function(){return this.jsonEditor.getValue()}}},l=s,u=(e("b8b0"),e("2877")),c=Object(u["a"])(l,n,i,!1,null,"fad11014",null);o["a"]=c.exports}}]);